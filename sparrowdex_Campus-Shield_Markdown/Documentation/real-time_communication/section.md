# Real-time Communication

## Real-time Communication in Campus-Shield

<document-code-reference section="Real-time Communication in Campus-Shield">
{"files": [
  {
    "name": "Campus-Shield/server/index.js",
    "description": "JavaScript/TypeScript implementation file",
    "file_url": "https://github.com/sparrowdex/Campus-Shield/blob/main/server/index.js",
    "directory": "https:/github.com/sparrowdex/Campus-Shield/blob/main/server"
  },
  {
    "name": "Campus-Shield/client/src/pages/MyReports.tsx",
    "description": "Implementation file",
    "file_url": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/MyReports.tsx",
    "directory": "https:/github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages"
  },
  {
    "name": "Campus-Shield/server/routes/admin.js",
    "description": "JavaScript/TypeScript implementation file",
    "file_url": "https://github.com/sparrowdex/Campus-Shield/blob/main/server/routes/admin.js",
    "directory": "https:/github.com/sparrowdex/Campus-Shield/blob/main/server/routes"
  },
  {
    "name": "Campus-Shield/README.md",
    "description": "Documentation file",
    "file_url": "https://github.com/sparrowdex/Campus-Shield/blob/main/README.md",
    "directory": "https:/github.com/sparrowdex/Campus-Shield/blob/main"
  }
]}
</document-code-reference>

<artifact ArtifactUUID="73e6e057-029e-465c-a249-cc7e01cfa811">Socket.IO Integration for Real-time Messaging</artifact>

The Campus-Shield project implements real-time communication using Socket.IO, a powerful library for bidirectional and event-based communication. The core of this functionality is implemented in the `socketService.js` file.

### Socket Authentication and Connection

```javascript
io.use(async (socket, next) => {
  try {
    const token = socket.handshake.auth.token;
    if (!token) {
      return next(new Error('Authentication error'));
    }
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.userId);
    if (!user || !user.isActive) {
      return next(new Error('User not found or inactive'));
    }
    socket.user = {
      userId: user._id,
      anonymousId: user.anonymousId,
      role: user.role,
      isAnonymous: user.isAnonymous
    };
    next();
  } catch (error) {
    next(new Error('Authentication error'));
  }
});
```

This middleware authenticates each socket connection using JWT tokens, ensuring secure communication channels for each user.

<artifact ArtifactUUID="88839302-2b63-4490-b16c-dd85557ffc7f">Chat Room Management and Messaging</artifact>

### Chat Room Operations

The system uses a `ChatRoom` model to manage conversations:

```javascript
const ChatRoomSchema = new mongoose.Schema({
  reportId: { type: String, required: true, unique: true },
  participants: [{ type: String, required: true }],
  createdAt: { type: Date, default: Date.now }
});
```

Chat rooms are created for each report, allowing users and administrators to communicate about specific incidents.

### Real-time Message Handling

```javascript
socket.on('send_message', (data) => {
  const { roomId, message } = data;
  io.to(roomId).emit('new_message', {
    id: Date.now().toString(),
    senderId: socket.user.userId,
    senderRole: socket.user.role,
    message,
    timestamp: new Date(),
    isAnonymous: socket.user.isAnonymous
  });
  if (socket.user.role === 'user') {
    io.to('admin_room').emit('user_message', {
      roomId,
      message: message.substring(0, 100) + (message.length > 100 ? '...' : ''),
      timestamp: new Date()
    });
  }
});
```

This event handler processes incoming messages and broadcasts them to the appropriate chat room. It also notifies administrators of new user messages.

<artifact ArtifactUUID="2f108d9c-141f-463f-9055-0de1a58fbc1d">Client-side Real-time Communication Implementation</artifact>

### React Integration with Socket.IO

The `Chat.tsx` component in the client application manages the connection to the Socket.IO server:

```typescript
useEffect(() => {
  const token = localStorage.getItem('token');
  const socket = io(process.env.REACT_APP_SOCKET_URL, {
    auth: { token },
    transports: ['websocket']
  });
  socketRef.current = socket;
  return () => {
    socket.disconnect();
  };
}, []);
```

This setup ensures that each client maintains a persistent connection to the server for real-time updates.

### Message Handling and Display

```typescript
useEffect(() => {
  if (selectedRoom && socketRef.current) {
    socketRef.current.emit('join_chat_room', selectedRoom);
    socketRef.current.on('new_message', (msg: Message) => {
      setMessages(prev => [...prev, msg]);
    });
    return () => {
      socketRef.current?.emit('leave_chat_room', selectedRoom);
      socketRef.current?.off('new_message');
    };
  }
}, [selectedRoom]);
```

This effect manages joining and leaving chat rooms, as well as handling incoming messages in real-time.

<artifact ArtifactUUID="3e32bd13-f5d7-4a4b-b352-5c307e25e024">Notification System for Real-time Updates</artifact>

### Server-side Notification Handling

The `Notification` model is used to store and manage notifications:

```javascript
const NotificationSchema = new mongoose.Schema({
  userId: { type: String, required: true },
  type: { type: String, required: true },
  content: { type: String, required: true },
  link: { type: String },
  read: { type: Boolean, default: false },
  createdAt: { type: Date, default: Date.now }
});
```

Notifications are created for various events in the system, including new messages and report updates.

### Client-side Notification Management

The `NotificationContext` in the client application manages the state of notifications:

```typescript
const [notifications, setNotifications] = useState<Notification[]>([]);

const addNotification = (notification: Notification) => {
  setNotifications(prev => [notification, ...prev]);
};

const markAsRead = async (notificationId: string) => {
  try {
    await fetch(`${process.env.REACT_APP_API_URL}/api/notifications/${notificationId}/read`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    });
    setNotifications(prev =>
      prev.map(n => n.id === notificationId ? { ...n, read: true } : n)
    );
  } catch (error) {
    console.error('Failed to mark notification as read:', error);
  }
};
```

This context provides functions to add new notifications and mark them as read, ensuring that users are always up-to-date with the latest information.

## Conclusion

The real-time communication system in Campus-Shield provides a robust and secure platform for instant messaging and notifications. By leveraging Socket.IO and integrating it with React on the client-side, the application ensures responsive and efficient communication between users and administrators. The notification system complements this by keeping users informed of important updates and new messages, enhancing the overall user experience and effectiveness of the campus safety reporting system.
## References:
### Code:
<code-reference uuid='0b33f76a-e39d-4c15-be4e-400655088115'>[{"file_name": "Campus-Shield/server/services/memoryStore.js", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/server/services/memoryStore.js", "markdown_link": "- [Campus-Shield/server/services/memoryStore.js](https://github.com/sparrowdex/Campus-Shield/blob/main/server/services/memoryStore.js)\n", "code_chunk": "// Admin request operations\n  createAdminRequest(userId, requestData) {\n    const request = {\n      id: this.nextRequestId.toString(),\n      userId,\n      ...requestData,\n      status: 'pending', // pending, approved, rejected\n      createdAt: new Date().toISOString(),\n      reviewedBy: null,\n      reviewedAt: null,\n      reviewNotes: null\n    };\n    this.adminRequests.set(request.id, request);\n    this.nextRequestId++;\n    return request;\n  }\n\n  getAdminRequests(status = null) {\n    const requests = Array.from(this.adminRequests.values());\n    if (status) {\n      return requests.filter(req => req.status === status);\n    }\n    return requests;\n  }\n\n  updateAdminRequest(requestId, updates) {\n    const request = this.adminRequests.get(requestId);\n    if (request) {\n      Object.assign(request, updates, { \n        reviewedAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      });\n      this.adminRequests.set(requestId, request);\n      return request;\n    }\n    return null;\n  }\n\n  approveAdminRequest(requestId, approvedBy, notes = '') {\n    const request = this.updateAdminRequest(requestId, {\n      status: 'approved',\n      reviewedBy: approvedBy,\n      reviewNotes: notes\n    });\n\n    if (request) {\n      // Promote user to admin\n      this.updateUser(request.userId, { role: 'admin' });\n    }\n\n    return request;\n  }\n\n  rejectAdminRequest(requestId, rejectedBy, notes = '') {\n    return this.updateAdminRequest(requestId, {\n      status: 'rejected',\n      reviewedBy: rejectedBy,\n      reviewNotes: notes\n    });\n  }\n\n  // Report operations\n  createReport(reportData) {\n    const report = {\n      id: this.nextReportId.toString(),\n      ...reportData,\n      status: 'pending',\n      priority: 'medium',\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      attachments: [],\n      publicUpdates: []\n    };\n    this.reports.set(report.id, report);\n    this.nextReportId++;\n    return report;\n  }\n\n  findReportsByUserId(userId) {\n    const userReports = [];\n    for (const report of this.reports.values()) {\n      if (report.userId === userId) {\n        userReports.push(report);\n      }\n    }\n    return userReports;\n  }\n\n  findReportById(id) {\n    return this.reports.get(id) || null;\n  }\n\n  updateReport(id, updates) {\n    const report = this.reports.get(id);\n    if (report) {\n      Object.assign(report, updates, { updatedAt: new Date().toISOString() });\n      this.reports.set(id, report);\n      return report;\n    }\n    return null;\n  }\n\n  // Chat operations\n  createChatRoom(roomData) {\n    const room = {\n      roomId: this.nextRoomId.toString(),\n      ...roomData,\n      createdAt: new Date().toISOString(),\n      lastMessage: null\n    };\n    this.chatRooms.set(room.roomId, room);\n    this.nextRoomId++;\n    return room;\n  }\n\n  findChatRoomByReportId(reportId) {\n    for (const room of this.chatRooms.values()) {\n      if (room.reportId === reportId) {\n        return room;\n      }\n    }\n    return null;\n  }\n\n  findChatRoomsByUserId(userId) {\n    const userRooms = [];\n    for (const room of this.chatRooms.values()) {\n      if (room.userId === userId) {\n        userRooms.push(room);\n      }\n    }\n    return userRooms;\n  }\n\n  createMessage(messageData) {\n    const message = {\n      id: this.nextMessageId.toString(),\n      ...messageData,\n      timestamp: new Date().toISOString()\n    };\n    this.messages.set(message.id, message);\n    this.nextMessageId++;\n    return message;\n  }\n\n  findMessagesByRoomId(roomId) {\n    const roomMessages = [];\n    for (const message of this.messages.values()) {\n      if (message.roomId === roomId) {\n        roomMessages.push(message);\n      }\n    }\n    return roomMessages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));\n  }\n\n  // Admin operations\n  getAllReports() {\n    return Array.from(this.reports.values());\n  }\n\n  getAllUsers() {\n    return Array.from(this.users.values());\n  }"}, {"file_name": "Campus-Shield/client/src/pages/MyReports.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/MyReports.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/MyReports.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/MyReports.tsx)\n", "code_chunk": "{/* Report Detail Modal */}\n      {selectedReport && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-bold text-gray-900\">Report Details</h2>\n                <button\n                  onClick={() => setSelectedReport(null)}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  <XMarkIcon className=\"h-6 w-6\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">{selectedReport.title}</h3>\n                  <div className=\"flex items-center space-x-3 mb-3\">\n                    <span className={`badge ${statusColors[selectedReport.status as keyof typeof statusColors]}`}>\n                      {selectedReport.status.replace('_', ' ').toUpperCase()}\n                    </span>\n                    <span className={`badge ${priorityColors[selectedReport.priority as keyof typeof priorityColors]}`}>\n                      {selectedReport.priority.toUpperCase()}\n                    </span>\n                  </div>\n                </div>\n\n                <div>\n                  <h4 className=\"font-medium text-gray-900 mb-2\">Description</h4>\n                  <p className=\"text-gray-600\">{selectedReport.description}</p>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <h4 className=\"font-medium text-gray-900 mb-2\">Category</h4>\n                    <p className=\"text-gray-600 capitalize\">\n                      {categoryLabels[selectedReport.category as keyof typeof categoryLabels]}\n                    </p>\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-gray-900 mb-2\">Incident Time</h4>\n                    <p className=\"text-gray-600\">{formatDate(selectedReport.incidentTime)}</p>\n                  </div>\n                </div>\n\n                                 <div>\n                   <h4 className=\"font-medium text-gray-900 mb-2\">Location</h4>\n                   <div className=\"text-gray-600\">\n                     {selectedReport.location?.address && <p>{selectedReport.location.address}</p>}\n                     {selectedReport.location?.building && <p>Building: {selectedReport.location.building}</p>}\n                     {selectedReport.location?.floor && <p>Floor: {selectedReport.location.floor}</p>}\n                     {!selectedReport.location?.address && !selectedReport.location?.building && !selectedReport.location?.floor && (\n                       <p className=\"text-gray-500\">Location not specified</p>\n                     )}\n                   </div>\n                 </div>\n\n                                 {selectedReport.attachments && selectedReport.attachments.length > 0 && (\n                   <div>\n                     <h4 className=\"font-medium text-gray-900 mb-2\">Attachments</h4>\n                     <div className=\"space-y-2\">\n                       {selectedReport.attachments.map((file, index) => (\n                         <div key={index} className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                           <DocumentIcon className=\"h-4 w-4\" />\n                           <span>{file.originalName || file.filename || 'Unknown file'}</span>\n                         </div>\n                       ))}\n                     </div>\n                   </div>\n                 )}"}, {"file_name": "Campus-Shield/docs/TECH_STACK_AND_WORKFLOW.md", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/docs/TECH_STACK_AND_WORKFLOW.md", "markdown_link": "- [Campus-Shield/docs/TECH_STACK_AND_WORKFLOW.md](https://github.com/sparrowdex/Campus-Shield/blob/main/docs/TECH_STACK_AND_WORKFLOW.md)\n", "code_chunk": "# CampusShield Tech Stack and Workflow Documentation\n\n## Recommended Tech Stack\n\n| Layer                | Technology Options                                                                                                          | Notes                                                     |\n|----------------------|----------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n| **Front-End**        | React.js, React Native (mobile), Flutter (mobile)                                                                          | For web/mobile apps; Flutter enables true cross-platform  |\n| **Back-End/API**     | Node.js (Express.js), Python (FastAPI or Django)                                                                           | Scalable REST APIs, real-time features                    |\n| **Database**         | MongoDB (NoSQL), PostgreSQL (SQL)                                                                                          | MongoDB for flexible data; PostgreSQL for relational data |\n| **Authentication**   | Firebase Auth, Auth0, or custom JWT-based auth                                                                             | Secure sign-in, supports anonymity and OAuth              |\n| **Notifications**    | Firebase Cloud Messaging (push), Twilio (SMS), SendGrid (email)                                                            | Real-time and multi-channel notifications                 |\n| **AI/ML Integration**| Python (scikit-learn, Hugging Face Transformers, spaCy) via an API microservice                                           | For categorization, sentiment analysis, NLP               |\n| **Chat/Real-Time**   | Socket.io (Node.js), WebSockets, or Firebase Realtime Database                                                             | For admin-user anonymous chat, group support              |\n| **Maps/Heatmaps**    | Google Maps API, Mapbox, Leaflet.js                                                                                        | For live incident heatmaps                                |\n| **File Storage**     | AWS S3, Google Cloud Storage, Firebase Storage                                                                             | For reports with photos, voice, or video                  |\n| **Admin Dashboard**  | React (web-based), Chart.js/D3.js for analytics and visualizations                                                         | Data visualization and report management                  |\n| **Hosting/Infra**    | AWS, Google Cloud Platform, Azure, Vercel, Heroku                                                                          | Scalable and easy deployment                              |\n| **Security**         | HTTPS/SSL, end-to-end encryption (Signal Protocol, custom), privacy libraries                                              | To ensure report privacy and anonymous chat               |\n| **Localization**     | i18next, Google Cloud Translation                                                                                          | For multilingual support                                  |\n\n## MVP Tech Stack (Phase 1)\n\nFor the initial MVP, we'll use a simplified but scalable stack:\n\n- **Frontend**: React.js with Tailwind CSS\n- **Backend**: Node.js with Express.js\n- **Database**: MongoDB (flexible schema for reports)\n- **Real-time**: Socket.io for chat and live updates\n- **Authentication**: JWT-based with anonymous options\n- **Maps**: Leaflet.js for heatmap visualization\n- **File Storage**: Local storage initially, cloud storage later\n- **AI/ML**: Basic text classification using natural language processing\n\n## Suggested Workflow\n\n### 1. User Onboarding & Authentication\n- Users sign up with minimal data, choose anonymity (no personal info required).\n- Optional: Offer OAuth (Google, college email) for added features with clear privacy messaging."}, {"file_name": "Campus-Shield/server/services/socketService.js", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/server/services/socketService.js", "markdown_link": "- [Campus-Shield/server/services/socketService.js](https://github.com/sparrowdex/Campus-Shield/blob/main/server/services/socketService.js)\n", "code_chunk": "const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\nconst initializeSocket = (io) => {\n  // Authentication middleware\n  io.use(async (socket, next) => {\n    try {\n      const token = socket.handshake.auth.token;\n      \n      if (!token) {\n        return next(new Error('Authentication error'));\n      }\n\n      const decoded = jwt.verify(token, process.env.JWT_SECRET || 'your-secret-key');\n      const user = await User.findById(decoded.userId);\n      \n      if (!user || !user.isActive) {\n        return next(new Error('User not found or inactive'));\n      }\n\n      socket.user = {\n        userId: user._id,\n        anonymousId: user.anonymousId,\n        role: user.role,\n        isAnonymous: user.isAnonymous\n      };\n\n      next();\n    } catch (error) {\n      next(new Error('Authentication error'));\n    }\n  });\n\n  io.on('connection', (socket) => {\n    console.log(`User connected: ${socket.user.anonymousId}`);\n\n    // Join user to their personal room\n    socket.join(`user_${socket.user.userId}`);\n\n    // Join admin to admin room if admin\n    if (socket.user.role === 'admin') {\n      socket.join('admin_room');\n    }\n\n    // Join chat room\n    socket.on('join_chat_room', (roomId) => {\n      socket.join(roomId);\n      console.log(`User ${socket.user.anonymousId} joined room: ${roomId}`);\n    });\n\n    // Leave chat room\n    socket.on('leave_chat_room', (roomId) => {\n      socket.leave(roomId);\n      console.log(`User ${socket.user.anonymousId} left room: ${roomId}`);\n    });\n\n    // Send message\n    socket.on('send_message', (data) => {\n      const { roomId, message } = data;\n      \n      // Emit to room\n      io.to(roomId).emit('new_message', {\n        id: Date.now().toString(),\n        senderId: socket.user.userId,\n        senderRole: socket.user.role,\n        message,\n        timestamp: new Date(),\n        isAnonymous: socket.user.isAnonymous\n      });\n\n      // Notify admins if message is from user\n      if (socket.user.role === 'user') {\n        io.to('admin_room').emit('user_message', {\n          roomId,\n          message: message.substring(0, 100) + (message.length > 100 ? '...' : ''),\n          timestamp: new Date()\n        });\n      }\n    });\n\n    // Report status updates\n    socket.on('report_status_update', (data) => {\n      const { reportId, status, message } = data;\n      \n      // Notify user about their report update\n      io.to(`user_${socket.user.userId}`).emit('report_updated', {\n        reportId,\n        status,\n        message,\n        timestamp: new Date()\n      });\n    });\n\n    // Location-based alerts\n    socket.on('location_update', (data) => {\n      const { latitude, longitude } = data;\n      \n      // In a real implementation, you would check for nearby incidents\n      // and send alerts to users in high-report areas\n      console.log(`User ${socket.user.anonymousId} location: ${latitude}, ${longitude}`);\n    });\n\n    // Typing indicators\n    socket.on('typing_start', (roomId) => {\n      socket.to(roomId).emit('user_typing', {\n        userId: socket.user.userId,\n        isTyping: true\n      });\n    });\n\n    socket.on('typing_stop', (roomId) => {\n      socket.to(roomId).emit('user_typing', {\n        userId: socket.user.userId,\n        isTyping: false\n      });\n    });\n\n    // Disconnect\n    socket.on('disconnect', () => {\n      console.log(`User disconnected: ${socket.user.anonymousId}`);\n    });\n  });\n\n  // Global error handler\n  io.on('error', (error) => {\n    console.error('Socket.io error:', error);\n  });\n};\n\nmodule.exports = { initializeSocket };"}, {"file_name": "Campus-Shield/client/src/index.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/index.tsx", "markdown_link": "- [Campus-Shield/client/src/index.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/index.tsx)\n", "code_chunk": "import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(\n  document.getElementById('root') as HTMLElement\n);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();"}, {"file_name": "Campus-Shield/client/src/pages/AdminDashboard.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/AdminDashboard.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/AdminDashboard.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/AdminDashboard.tsx)\n", "code_chunk": "const assignedToIdStr = assignedToId ? String(assignedToId) : null;\n  const currentUserIdStr = currentUserId ? String(currentUserId) : null;\n\n  console.log('currentUserId:', currentUserId);\n  console.log('assignedToId:', assignedToId);\n  console.log('selectedReport:', selectedReport);\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      <div className=\"card\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Admin Dashboard</h1>\n          <div className=\"flex items-center space-x-4\">\n            {user?.role === 'moderator' && (\n              <Link\n                to=\"/admin/requests\"\n                className=\"btn-primary\"\n              >\n                <ShieldCheckIcon className=\"h-4 w-4 mr-2\" />\n                Admin Requests\n              </Link>\n            )}\n            <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\n              <ShieldCheckIcon className=\"h-5 w-5\" />\n              <span>Administrator Access</span>\n            </div>\n          </div>\n        </div>\n\n        {error && (\n          <div className=\"mb-6 bg-danger-50 border border-danger-200 rounded-md p-4\">\n            <p className=\"text-sm text-danger-700\">{error}</p>\n          </div>\n        )}\n\n        {/* Stats Cards */}\n        {stats && (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-2 bg-primary-100 rounded-lg\">\n                  <UsersIcon className=\"h-6 w-6 text-primary-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-600\">Total Users</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.totalUsers}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-2 bg-warning-100 rounded-lg\">\n                  <ExclamationTriangleIcon className=\"h-6 w-6 text-warning-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-600\">Total Reports</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.totalReports}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-2 bg-danger-100 rounded-lg\">\n                  <ClockIcon className=\"h-6 w-6 text-danger-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-600\">Pending Reports</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.pendingReports}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-2 bg-success-100 rounded-lg\">\n                  <CheckCircleIcon className=\"h-6 w-6 text-success-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-600\">Resolution Rate</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.resolutionRate}%</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}"}, {"file_name": "Campus-Shield/client/src/pages/Chat.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/Chat.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/Chat.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/Chat.tsx)\n", "code_chunk": "{/* Chat Messages */}\n          <div className={`flex-1 flex flex-col min-h-0 ${showSidebarMobile && window.innerWidth < 768 ? 'hidden' : ''} md:flex`}>\n            {selectedRoom ? (\n              <>\n                {/* Back button for mobile */}\n                <div className=\"md:hidden flex items-center mb-2\">\n                  <button onClick={handleBackToSidebar} className=\"mr-2 p-2 rounded hover:bg-gray-100\">\n                    <ArrowLeftIcon className=\"h-5 w-5 text-gray-500\" />\n                  </button>\n                  <span className=\"font-medium text-gray-700\">Back to conversations</span>\n                </div>\n                {/* Messages Area */}\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                  {messages.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <ChatBubbleLeftRightIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No messages yet</h3>\n                      <p className=\"text-gray-600\">\n                        Start the conversation by sending a message.\n                      </p>\n                    </div>\n                  ) : (\n                    messages.map((message, index) => {\n                      const isCurrentUser = user && message.senderId === user.id;\n                      const showDate = index === 0 || \n                        formatDate(message.timestamp) !== formatDate(messages[index - 1].timestamp);\n\n                      return (\n                        <div key={message.id}>\n                          {showDate && (\n                            <div className=\"text-center my-4\">\n                              <span className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">\n                                {formatDate(message.timestamp)}\n                              </span>\n                            </div>\n                          )}\n                          <div className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'}`}>\n                            <div className={`max-w-xs lg:max-w-md ${isCurrentUser ? 'order-2' : 'order-1'}`}>\n                              <div className={`flex items-center space-x-2 mb-1 ${isCurrentUser ? 'justify-end' : 'justify-start'}`}>\n                                {isCurrentUser ? (\n                                  <UserIcon className=\"h-4 w-4 text-gray-400\" />\n                                ) : (\n                                  <ShieldCheckIcon className=\"h-4 w-4 text-primary-600\" />\n                                )}\n                                <span className=\"text-xs text-gray-500\">\n                                  {isCurrentUser\n                                    ? 'You'\n                                    : message.senderRole === 'admin' || message.senderRole === 'moderator'\n                                      ? 'Campus Security'\n                                      : 'Anonymous User'}\n                                </span>\n                                <span className=\"text-xs text-gray-400\">\n                                  {formatTime(message.timestamp)}\n                                </span>\n                              </div>\n                              <div\n                                className={`p-3 rounded-lg ${\n                                  isCurrentUser\n                                    ? 'bg-primary-600 text-white'\n                                    : 'bg-gray-100 text-gray-900'\n                                }`}\n                              >\n                                <p className=\"text-sm\">{message.message}</p>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })\n                  )}\n                  <div ref={messagesEndRef} />\n                </div>"}, {"file_name": "Campus-Shield/client/src/pages/AdminRequests.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/AdminRequests.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/AdminRequests.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/AdminRequests.tsx)\n", "code_chunk": "<div className=\"space-y-4\">\n                <div>\n                  <h3 className=\"font-medium text-gray-900 mb-2\">Applicant Information</h3>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <span className=\"text-sm font-medium text-gray-700\">Email:</span>\n                      <p className=\"text-sm text-gray-900\">{selectedRequest.user?.email}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-sm font-medium text-gray-700\">Role:</span>\n                      <p className=\"text-sm text-gray-900\">{selectedRequest.role}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-sm font-medium text-gray-700\">Department:</span>\n                      <p className=\"text-sm text-gray-900\">{selectedRequest.department}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-sm font-medium text-gray-700\">Urgency:</span>\n                      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getUrgencyColor(selectedRequest.urgency)}`}>\n                        {selectedRequest.urgency.charAt(0).toUpperCase() + selectedRequest.urgency.slice(1)}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"font-medium text-gray-900 mb-2\">Experience</h3>\n                  <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">{selectedRequest.experience}</p>\n                </div>\n\n                <div>\n                  <h3 className=\"font-medium text-gray-900 mb-2\">Current Responsibilities</h3>\n                  <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">{selectedRequest.responsibilities}</p>\n                </div>\n\n                <div>\n                  <h3 className=\"font-medium text-gray-900 mb-2\">Reason for Admin Access</h3>\n                  <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">{selectedRequest.reason}</p>\n                </div>\n\n                {selectedRequest.contactInfo && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-2\">Additional Contact</h3>\n                    <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">{selectedRequest.contactInfo}</p>\n                  </div>\n                )}\n\n                {selectedRequest.status === 'pending' && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-2\">Review Notes</h3>\n                    <textarea\n                      value={reviewNotes}\n                      onChange={(e) => setReviewNotes(e.target.value)}\n                      className=\"input-field\"\n                      rows={3}\n                      placeholder=\"Add notes about your decision...\"\n                    />\n                  </div>\n                )}\n\n                {selectedRequest.status !== 'pending' && selectedRequest.reviewNotes && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-2\">Review Notes</h3>\n                    <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">{selectedRequest.reviewNotes}</p>\n                  </div>\n                )}"}, {"file_name": "Campus-Shield/client/src/pages/RequestAdmin.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/RequestAdmin.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/RequestAdmin.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/RequestAdmin.tsx)\n", "code_chunk": "{/* Urgency & Timeline */}\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Urgency & Timeline</h3>\n            <div>\n              <label htmlFor=\"urgency\" className=\"form-label\">\n                Urgency Level *\n              </label>\n              <select\n                id=\"urgency\"\n                name=\"urgency\"\n                required\n                value={formData.urgency}\n                onChange={handleInputChange}\n                className=\"input-field\"\n              >\n                <option value=\"\">Select urgency level</option>\n                <option value=\"low\">Low - General administrative needs</option>\n                <option value=\"medium\">Medium - Regular operational requirements</option>\n                <option value=\"high\">High - Immediate safety/security needs</option>\n                <option value=\"critical\">Critical - Emergency response requirements</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Contact Information */}\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Additional Contact Information</h3>\n            <div>\n              <label htmlFor=\"contactInfo\" className=\"form-label\">\n                Additional Contact Details\n              </label>\n              <textarea\n                id=\"contactInfo\"\n                name=\"contactInfo\"\n                rows={2}\n                value={formData.contactInfo}\n                onChange={handleInputChange}\n                className=\"input-field\"\n                placeholder=\"Phone number, office location, or any additional contact information...\"\n              />\n            </div>\n          </div>\n\n          {/* Primary Reason */}\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Primary Reason for Admin Access</h3>\n            <div>\n              <label htmlFor=\"reason\" className=\"form-label\">\n                Detailed Explanation *\n              </label>\n              <textarea\n                id=\"reason\"\n                name=\"reason\"\n                rows={4}\n                required\n                minLength={10}\n                maxLength={500}\n                value={formData.reason}\n                onChange={handleInputChange}\n                className=\"input-field\"\n                placeholder=\"Please provide a comprehensive explanation of why you need admin access, how you plan to use it, and the benefits to campus safety...\"\n              />\n              <p className=\"mt-1 text-xs text-gray-500\">\n                {formData.reason.length}/500 characters (minimum 10 characters)\n              </p>\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-gray-900 mb-2\">What Admin Access Includes:</h4>\n            <ul className=\"text-sm text-gray-600 space-y-1\">\n              <li>\u2022 View and manage all incident reports</li>\n              <li>\u2022 Update report statuses and priorities</li>\n              <li>\u2022 Access to analytics and statistics</li>\n              <li>\u2022 Ability to respond to reports</li>\n              <li>\u2022 Review and approve admin requests</li>\n            </ul>\n          </div>"}, {"file_name": "Campus-Shield/client/src/pages/ReportIncident.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/ReportIncident.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/ReportIncident.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/ReportIncident.tsx)\n", "code_chunk": "<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label htmlFor=\"address\" className=\"form-label\">\n                    Address\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"address\"\n                    name=\"location.address\"\n                    value={formData.location.address}\n                    onChange={handleInputChange}\n                    className=\"input-field\"\n                    placeholder=\"Street address or general area\"\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"building\" className=\"form-label\">\n                    Building\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"building\"\n                    name=\"location.building\"\n                    value={formData.location.building}\n                    onChange={handleInputChange}\n                    className=\"input-field\"\n                    placeholder=\"Building name or number\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label htmlFor=\"floor\" className=\"form-label\">\n                  Floor/Room\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"floor\"\n                  name=\"location.floor\"\n                  value={formData.location.floor}\n                  onChange={handleInputChange}\n                  className=\"input-field\"\n                  placeholder=\"Floor number or room number\"\n                />\n              </div>\n\n              <div className=\"flex items-center space-x-4\">\n                <button\n                  type=\"button\"\n                  onClick={handleLocationClick}\n                  className=\"btn-secondary\"\n                >\n                  <MapPinIcon className=\"h-4 w-4 mr-2\" />\n                  Use My Current Location\n                </button>\n                {formData.location.coordinates && (\n                  <span className=\"text-sm text-success-600\">\n                    \u2713 Location captured\n                  </span>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Step 3: Attachments */}\n          {currentStep === 3 && (\n            <div className=\"space-y-6\">\n              <div className=\"bg-secondary-50 border border-secondary-200 rounded-lg p-4\">\n                <div className=\"flex items-center mb-2\">\n                  <CameraIcon className=\"h-5 w-5 text-secondary-600 mr-2\" />\n                  <h3 className=\"font-medium text-secondary-900\">Attachments (Optional)</h3>\n                </div>\n                <p className=\"text-sm text-secondary-700\">\n                  You can upload photos, videos, or documents related to the incident. Maximum 5 files, 10MB each.\n                </p>\n              </div>\n\n              <div>\n                <button\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"btn-secondary w-full\"\n                >\n                  <DocumentIcon className=\"h-4 w-4 mr-2\" />\n                  Choose Files\n                </button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  accept=\"image/*,video/*,audio/*,.pdf\"\n                  onChange={handleFileUpload}\n                  className=\"hidden\"\n                />\n              </div>"}, {"file_name": "Campus-Shield/client/src/pages/Home.tsx", "file_path": "https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/Home.tsx", "markdown_link": "- [Campus-Shield/client/src/pages/Home.tsx](https://github.com/sparrowdex/Campus-Shield/blob/main/client/src/pages/Home.tsx)\n", "code_chunk": "{/* Features Section */}\n      <section className=\"bg-gray-50 py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              Why Choose CampusShield?\n            </h2>\n            <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n              Our privacy-first approach ensures you can report safety concerns without fear, \n              while powerful features help keep everyone informed and protected.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {features.map((feature, index) => (\n              <div key={index} className=\"card hover:shadow-md transition-shadow duration-200\">\n                <div className=\"flex items-center mb-4\">\n                  <feature.icon className=\"h-8 w-8 text-primary-600 mr-3\" />\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    {feature.title}\n                  </h3>\n                </div>\n                <p className=\"text-gray-600\">\n                  {feature.description}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* How It Works Section */}\n      <section className=\"bg-white py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              How It Works\n            </h2>\n            <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n              Simple, secure, and anonymous reporting in just a few steps.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            <div className=\"text-center\">\n              <div className=\"bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                <span className=\"text-2xl font-bold text-primary-600\">1</span>\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Report Incident</h3>\n              <p className=\"text-gray-600\">\n                Submit a detailed report with location, description, and optional media attachments.\n              </p>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                <span className=\"text-2xl font-bold text-primary-600\">2</span>\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">AI Processing</h3>\n              <p className=\"text-gray-600\">\n                Our AI categorizes and prioritizes your report for appropriate response.\n              </p>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                <span className=\"text-2xl font-bold text-primary-600\">3</span>\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Stay Updated</h3>\n              <p className=\"text-gray-600\">\n                Receive updates on your report and chat with authorities if needed.\n              </p>\n            </div>\n          </div>\n        </div>\n      </section>"}]</code-reference>